#!/bin/bash

# especially useful for submodules
TARGET=$(realpath ${1:-".git"})

{
  find "$TARGET/objects/pack" -name "*.idx" |
    while read i; do
      git show-index < "$i" | awk '{print $2}';
    done;

  find "$TARGET/objects/" -type f | grep -va '/pack/' |
    awk -F'/' '{print $(NF-1)$NF}';
} | while read o; do
  git cat-file -p "$o";
done;
